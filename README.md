# zator
Engine and Programming Language

# Документация по языку программирования Zator

## 1. Введение

Zator — это специализированный язык программирования для создания AI-генерируемого контента с использованием API KoboldCpp. Он предоставляет простой и интуитивно понятный синтаксис для генерации текста, изображений и взаимодействия с LLM-моделями. Zator позволяет создавать сложные генеративные пайплайны с минимальным количеством кода.

## 2. Установка и настройка

### Системные требования
- Windows 10/11
- Запущенный экземпляр KoboldCpp с API на порту 5001
- Доступ к GPU для генерации изображений (рекомендуется)

### Запуск скриптов
```bash
zator.exe ваш_скрипт.zator
```

## 3. Синтаксис языка

### 3.1. Базовые конструкции

**Комментарии**
```python
# Это однострочный комментарий
```

**Контекст**
```python
context = "Вы - помощник, специализирующийся на создании творческого контента."
```

### 3.2. Переменные и типы данных

Zator поддерживает три основных типа данных:

1. **Текстовые переменные (VAR_STRING)**
```python
var greeting = "Привет, мир!"
var story = generate_text("Напишите короткую историю о кобольде", context, 200)
```

2. **Целочисленные переменные (VAR_INT)**
```python
var counter = 42
var score = 85
```

3. **Переменные изображений (VAR_IMAGE)**
```python
var portrait = generate_img("Портрет дружелюбного кобольда, цифровое искусство", context, 512, 512)
```

### 3.3. F-строки

F-строки позволяют встраивать переменные и выражения внутрь строковых литералов. Синтаксис: `{имя_переменной}`.

```python
var username = "Алексей"
print("Привет, {username}! Сегодняшняя дата: {current_date}")
```

F-строки работают везде, где используются строки:
- В аргументах функций
- В присваиваниях переменных
- В путях к файлам
- В условиях
- В сгенерированном контенте

Примечание: для вывода литеральных фигурных скобок используйте экранирование: `\{` и `\}`.

### 3.4. Управляющие конструкции

#### Условные операторы
```python
if score > 80 {
    print("Отличный результат!")
} else if score > 60 {
    print("Хороший результат!")
} else {
    print("Нужно улучшить результат.")
}
```

Поддерживаемые операторы сравнения:
- `==` (равно)
- `!=` (не равно)
- `>` (больше)
- `<` (меньше)
- `>=` (больше или равно)
- `<=` (меньше или равно)

#### Циклы
```python
var countdown = 5
repeat 10 {
    countdown = countdown - 1
    print("Осталось времени: {countdown}")
    if countdown <= 0 {
        print("Цикл прерван досрочно")
        break
    }
}
```

Ключевое слово `break` немедленно прерывает выполнение цикла.

## 4. Функции генерации контента

### 4.1. Генерация текста

```python
var result = generate_text(prompt, context, max_tokens)
```

**Параметры:**
- `prompt` — текстовый запрос для генерации
- `context` — контекстная строка, определяющая роль/стиль генерации
- `max_tokens` — максимальное количество генерируемых токенов

**Пример:**
```python
var poem_prompt = "Напишите короткое стихотворение о программировании в стиле Шекспира"
var poem = generate_text(poem_prompt, context, 150)
print("Сгенерированное стихотворение:\n{poem}")
```

### 4.2. Генерация изображений

```python
var image = generate_img(prompt, context, width, height)
```

**Параметры:**
- `prompt` — текстовое описание изображения
- `context` — контекстная строка (используется для уточнения запроса)
- `width`, `height` — размеры генерируемого изображения в пикселях

**Пример:**
```python
var landscape_prompt = "Фантастический пейзаж с горами и озером под закатом, цифровая живопись"
var landscape = generate_img(landscape_prompt, context, 512, 512)
save_img(landscape, "output/landscape.png")
```

**Важно:** KoboldCpp автоматически корректирует размеры изображений для оптимизации использования VRAM. Рекомендуемые размеры кратны 64 пикселям (512x512, 768x512 и т.д.).

## 5. Работа с файлами

### 5.1. Сохранение текста
```python
save_txt(variable, "относительный/путь/к/файлу.txt")
```

**Пример:**
```python
save_txt(story, "output/story.txt")
```

### 5.2. Сохранение изображений
```python
save_img(variable, "относительный/путь/к/изображению.png")
```

**Пример:**
```python
save_img(landscape, "images/fantasy_landscape.png")
```

### 5.3. Ввод/вывод

**Чтение ввода пользователя:**
```python
input(username)
print("Приятно познакомиться, {username}!")
```

**Вывод на консоль:**
```python
print("Это сообщение будет выведено в консоль")
```

## 6. Продвинутые возможности

### 6.1. Настройка API сервера
```python
server = "http://localhost:5001"  # адрес по умолчанию
```

Этот параметр можно изменить для работы с другими экземплярами KoboldCpp или облачными сервисами.

### 6.2. Работа с массивами

```python
# Добавление элементов в демонстрационный массив
array_push_demo("первый элемент")
array_push_demo("второй элемент")

# Вывод содержимого массива
print_array()
```

### 6.3. Внедренный C-код
```python
emit_c("embedded/example.c")
```

Эта команда генерирует файл с примером C-кода в указанном пути.

## 7. Параметры генерации текста в KoboldCpp

Zator использует все доступные параметры API KoboldCpp для тонкой настройки генерации:

| Параметр | Описание | Значение по умолчанию |
|---------|----------|----------------------|
| `max_context_length` | Максимальное количество токенов контекста | 2048 |
| `max_length` | Количество токенов для генерации | 100 |
| `temperature` | Температура генерации (0-1) | 0.7 |
| `top_p` | Top-p sampling (0-1) | 0.9 |
| `top_k` | Top-k sampling | 100 |
| `rep_pen` | Пенальти за повторение | 1.1 |
| `use_default_badwordsids` | Использовать стандартные стоп-слова | false |

## 8. Примеры использования

### 8.1. Проcтой скрипт генерации истории
```python
context = "Вы - писатель-фантаст, создающий короткие истории о приключениях."

var character = "кобольд-изобретатель"
var location = "заброшенный замок"
var story_prompt = "Напишите короткую историю о {character}, исследующем {location}. История должна содержать неожиданную развязку."
var story = generate_text(story_prompt, context, 300)

print("\nСгенерированная история:\n{story}")
save_txt(story, "stories/kobold_castle.txt")

var illustration_prompt = "Иллюстрация к истории: {character} в {location}, цифровое искусство, фэнтези стиль"
var illustration = generate_img(illustration_prompt, context, 512, 512)
save_img(illustration, "images/kobold_castle.png")

print("\nИстория и иллюстрация успешно сохранены!")
```

### 8.2. Интерактивный генератор контента
```python
context = "Вы - помощник по созданию творческого контента."

print("Добро пожаловать в интерактивный генератор контента Zator!")
input(username)
print("Здравствуйте, {username}! Что вы хотели бы создать сегодня? (1 - стихотворение, 2 - короткая история)")

input(choice)
var prompt = ""
var tokens = 0

if choice == "1" {
    print("Введите тему для стихотворения:")
    input(theme)
    prompt = "Напишите короткое {theme}-стихотворение в стиле Пушкина."
    tokens = 100
} else if choice == "2" {
    print("Введите жанр истории:")
    input(genre)
    prompt = "Напишите очень короткую {genre} историю с неожиданной развязкой."
    tokens = 150
} else {
    prompt = "Напишите короткое приветственное сообщение для пользователя {username}."
    tokens = 50
}

var content = generate_text(prompt, context, tokens)
print("\nВаш сгенерированный контент:\n{content}")

print("\nХотите сохранить результат в файл? (да/нет)")
input(save_choice)
if save_choice == "да" {
    save_txt(content, "output/{username}_content.txt")
    print("Контент сохранен в файл output/{username}_content.txt")
}

print("Спасибо за использование Zator!")
```

## 9. Отладка и обработка ошибок

Zator автоматически обрабатывает большинство ошибок при взаимодействии с API, но для отладки сложных скриптов рекомендуется:

1. Проверять корректность путей к файлам
2. Убедиться, что KoboldCpp запущен и доступен по указанному адресу
3. При генерации изображений использовать рекомендуемые размеры
4. Разбивать сложные скрипты на более мелкие части для пошаговой проверки

## 10. Ограничения и известные проблемы

1. **Размеры изображений:** KoboldCpp автоматически корректирует размеры изображений до значений, кратных 64 пикселям, для оптимизации использования VRAM.

2. **Длина контекста:** Максимальная длина контекста ограничена параметром `max_context_length` (по умолчанию 2048 токена).

3. **Корректность f-строк:** При вложенных f-строках возможно некорректное разрешение переменных. Рекомендуется избегать чрезмерно сложных вложений.

4. **Работа с несколькими запросами:** При одновременной генерации нескольких элементов контента рекомендуется использовать последовательные вызовы для избежания перегрузки сервера.

## 11. Часто задаваемые вопросы

**Вопрос: Как увеличить качество генерируемых изображений?**
Ответ: Используйте большие размеры (кратные 64), добавляйте детали в промпт и уточняйте стиль (например, "цифровое искусство, фэнтези, высокое качество").

**Вопрос: Как уменьшить количество повторов в сгенерированном тексте?**
Ответ: Увеличьте параметр `rep_pen` (пенальти за повторение) в настройках генерации или используйте более конкретные промпты.

**Вопрос: Можно ли использовать Zator без локального сервера KoboldCpp?**
Ответ: Нет, Zator требует запущенного сервера KoboldCpp с API. Однако можно настроить подключение к удаленному серверу через параметр `server`.

**Вопрос: Как добавить собственные функции в Zator?**
Ответ: Zator не поддерживает пользовательские функции напрямую, но можно создавать шаблоны скриптов и переиспользовать их для похожих задач.

## 12. Техническая поддержка

Для получения помощи с использованием Zator:
- Проверьте корректность настройки KoboldCpp
- Убедитесь, что все пути к файлам существуют
- При необходимости обратитесь к документации API KoboldCpp
- Для отчетов об ошибках используйте систему issue на GitHub репозитории проекта

---

**Версия документации:** 1.0  
**Последнее обновление:** 8 января 2026 года
